# Data extraction



## Data types

Choose your data types!

Reference: R4DS Ch. 15, 16



## Time indexing in data

* Depending on how dates and times are recorded in your raw data, you may face more or less work to organize them into form(s) suitable as `tsibble` index variable.

 - See R4DS ch. 16.
 
 - `lubridate` package may be valuable


# Data extraction

* Reproducible extraction of data from source location: may be complicated by access protocols.

  - access tokens; APIs
  - raw data from github for private repos
  - databases
  - httr
  
Make your extraction code "as reproducicle as possible", subject to these access constraints. At minimum, document clearly how you obtained the data, so others could follow your path, even if not via pure code.
 
Reminder: Keep your raw data in read-only mode. Don't edit these files. Write code to transform the raw data into form you will use for analysis.

```
---- Forwarded Message -----
From: GitHub <noreply@github.com>
To: Arthur Small <asmall@virginia.edu>
Sent: Sunday, February 21, 2021, 6:20:58 AM EST
Subject: [GitHub] Deprecation Notice

Hi @arthursmalliii,

You recently used a password to access the repository at uva-eng-time-series-sp21/coronato-nicholas with git using git/2.30.0.

Basic authentication using a password to Git is deprecated and will soon no longer work. Visit https://github.blog/2020-12-15-token-authentication-requirements-for-git-operations/ for more information around suggested workarounds and removal dates.

Thanks,
The GitHub Team
```

## Reading in data from source files

- Declaring data types as you read in data.

### Example using readr::read_csv

```{r Read in data from listed source}
# Data Source: https://www.eia.gov/petroleum/supply/weekly/

# Original code:
PetroStocksData <- readr::read_csv("data/PetroStocks.csv")
names(PetroStocksData) <- PetroStocksData[2,] # assign correct header
PetroStocksData <- PetroStocksData[-1,] # remove unused rows
PetroStocksData <- PetroStocksData[-1,] # remove unused rows

### Revised using readr::read_csv() to skip empty rows and declare data types
### Declare column types within the read_csv() function call, to save yourself trouble later:
ps_tbl <- readr::read_csv("data/PetroStocks.csv", skip = 2, col_types = cols(.default = col_double(),
                                                                       "Date"   = col_character())) 

### Reference: https://readr.tidyverse.org/reference/read_delim.html
```


# Data transformation



# Running diagnostics on your tsibble

** Ideally, should have exactly one row (i.e., one vector of measured values) for each time interval (`index`) and each value of the `key` variables. 
 -- May not have any duplicates.
 -- May have missing values
 
## Duplicate values 


## Missing values


## Irregular time intervals
